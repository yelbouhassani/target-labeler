<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Targets</title>
    <style>
        /* Grayscale theme and smaller fonts */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 20px;
            background-color: #fdfdfd;
            color: #333;
            font-size: 14px; /* Smaller base font size */
        }
        h1 {
            text-align: center;
            color: #222;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
        thead {
            background-color: #444; /* Dark grey header */
            color: #fdfdfd;
        }
        th, td {
            padding: 8px 12px; /* Reduced padding */
            border: 1px solid #ddd;
            text-align: left;
            vertical-align: middle;
        }
        tr:nth-child(even) {
            background-color: #f5f5f5; /* Light grey for even rows */
        }
        tr:hover {
            background-color: #e9e9e9; /* Slightly darker grey on hover */
        }
        td img {
            max-width: 80px; /* Smaller thumbnail */
            height: auto;
            display: block;
            border-radius: 4px;
            cursor: pointer; /* Add pointer cursor to indicate it's clickable */
            transition: transform 0.2s;
        }
        td img:hover {
            transform: scale(1.1); /* Slight zoom on hover */
        }
        #searchInput {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        /* Styles for the Image Modal */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            padding-top: 50px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }
        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
        }
        .close-button {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #bbb;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <h1>Learning Targets Overview</h1>

    <input type="text" id="searchInput" placeholder="Search by label, description, subject, topic, or category...">

    <table>
        <thead>
            <tr>
                <th>Target_ID</th>
                <th>Label</th>
                <th>Description</th>
                <th>Image</th>
                <th>Subject</th>
                <th>Topic</th>
                <th>Correct Topic.</th>
                <th>Category</th>
                <th>Correct Cat.</th>
            </tr>
        </thead>
        <tbody id="target-table-body">
            <!-- Table rows will be inserted here by JavaScript -->
        </tbody>
    </table>

    <!-- The Modal for displaying the larger image -->
    <div id="imageModal" class="modal">
        <span class="close-button">Ã—</span>
        <img class="modal-content" id="modalImage">
    </div>


    <script>
        let allTargets = [];

        function displayTargets(targets) {
            const tableBody = document.getElementById('target-table-body');
            tableBody.innerHTML = '';

            if (targets.length === 0) {
                const row = tableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 9; // Updated colspan to 9
                cell.textContent = 'No targets found.';
                cell.style.textAlign = 'center';
                return;
            }

            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');

            targets.forEach(target => {
                const row = tableBody.insertRow();

                // 1. Target_ID
                row.insertCell().textContent = target.Target_ID;

                // 2. Label
                row.insertCell().textContent = target.Label;

                // 3. Description
                row.insertCell().textContent = target.Description;

                // 4. Image
                const cellImage = row.insertCell();
                const image = document.createElement('img');
                image.src = `https://firebasestorage.googleapis.com/v0/b/leerlevels-data-server.appspot.com/o/targets%2F${target.Target_ID}%2Fm.png?alt=media`;
                image.alt = `Image for ${target.Label}`;
                image.onerror = () => { image.style.display = 'none'; cellImage.textContent = 'No Image'; };
                
                image.onclick = function() {
                    modal.style.display = "block";
                    modalImg.src = this.src;
                }
                cellImage.appendChild(image);

                // 5. Subject (NEW)
                const cellSubject = row.insertCell();
                cellSubject.textContent = Array.isArray(target.Subject) ? target.Subject.join(', ') : (target.Subject || '');
                
                // 6. Topic
                const cellTopic = row.insertCell();
                cellTopic.textContent = Array.isArray(target.Topic) ? target.Topic.join(', ') : (target.Topic || '');

                // 7. "Correct Topic." Checkbox
                const cellCorrectTopic = row.insertCell();
                const checkboxTopic = document.createElement('input');
                checkboxTopic.type = 'checkbox';
                checkboxTopic.checked = true;
                cellCorrectTopic.style.textAlign = 'center';
                cellCorrectTopic.appendChild(checkboxTopic);
                
                // 8. Category
                const cellCategory = row.insertCell();
                cellCategory.textContent = Array.isArray(target.Category) ? target.Category.join(', ') : (target.Category || '');

                // 9. "Correct Cat." Checkbox
                const cellCorrectCat = row.insertCell();
                const checkboxCat = document.createElement('input');
                checkboxCat.type = 'checkbox';
                checkboxCat.checked = true;
                cellCorrectCat.style.textAlign = 'center';
                cellCorrectCat.appendChild(checkboxCat);
            });
        }
        
        function filterTargets() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.toLowerCase();

            const filteredTargets = allTargets.filter(target => {
                // Ensure values are strings and lowercase before searching
                const label = (target.Label || '').toLowerCase();
                const description = (target.Description || '').toLowerCase();
                const subject = (Array.isArray(target.Subject) ? target.Subject.join(', ') : (target.Subject || '')).toLowerCase();
                const topic = (Array.isArray(target.Topic) ? target.Topic.join(', ') : (target.Topic || '')).toLowerCase();
                const category = (Array.isArray(target.Category) ? target.Category.join(', ') : (target.Category || '')).toLowerCase();

                return label.includes(searchTerm) ||
                       description.includes(searchTerm) ||
                       subject.includes(searchTerm) || // Added to search
                       topic.includes(searchTerm) ||
                       category.includes(searchTerm);
            });
            
            displayTargets(filteredTargets);
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetch('labeled_targets.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    allTargets = data;
                    displayTargets(allTargets);
                })
                .catch(error => {
                    console.error('Error fetching or parsing JSON:', error);
                    const tableBody = document.getElementById('target-table-body');
                    // Updated colspan to 9
                    tableBody.innerHTML = `<tr><td colspan="9" style="color: red; text-align: center;">Failed to load data. Please check if 'labeled_targets.json' exists and is in the same directory.</td></tr>`;
                });
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', filterTargets);

            const modal = document.getElementById('imageModal');
            const closeButton = document.querySelector('.close-button');
            
            closeButton.onclick = function() {
                modal.style.display = "none";
            }
            
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        });

    </script>

</body>
</html>